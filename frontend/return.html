<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Thanks — Magnetic Memories</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <main class="container">
    <h1>Thanks!</h1>
    <p class="subtitle">We’ve received your order. If you just paid, this page will confirm status shortly.</p>

    <section class="card">
      <p id="orderIdRow" class="hint">Order: <code id="orderId">…</code></p>
      <p id="statusRow">Status: <strong id="statusText">checking…</strong></p>
      <p class="hint">You’ll also get an email from us once we start printing (optional feature).</p>
    </section>
  </main>

  <script>
    // Read orderId from URL: /return?orderId=...
    const params = new URLSearchParams(location.search);
    const orderId = params.get("orderId");
    document.getElementById("orderId").textContent = orderId || "unknown";

    async function fetchStatus() {
      if (!orderId) {
        document.getElementById("statusText").textContent = "unknown";
        return;
      }
      try {
        const res = await fetch(`/api/order?id=${encodeURIComponent(orderId)}`);
        if (!res.ok) throw new Error("status not found");
        const data = await res.json();
        document.getElementById("statusText").textContent = data.status || "unknown";
      } catch {
        document.getElementById("statusText").textContent = "unknown";
      }
    }

    fetchStatus();
    // Poll a few times in case webhook lands a bit later
    let tries = 0;
    const iv = setInterval(async () => {
      tries++;
      await fetchStatus();
      if (tries >= 12) clearInterval(iv); // ~1 minute at 5s interval
    }, 5000);
  </script>
</body>
</html>
